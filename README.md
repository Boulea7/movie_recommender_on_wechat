# 基于机器学习的个性化电影推荐系统

**作者:** 刘鑫凯  
**项目性质:** 毕业设计作品  
**研究方向:** 基于协同过滤算法的电影推荐系统研究与实现  
**项目团队:** Mindsnap团队的电影推荐系统分团队

**更新日期:** 2025-01-27

## 项目简介

本项目旨在根据用户历史行为数据，利用机器学习算法（主要是协同过滤），为用户提供个性化的电影推荐。系统通过微信公众号与用户进行交互，用户可以搜索电影、评价电影，并获取个性化推荐。

## 系统架构

系统采用以下架构设计:

1. **前端界面**: 微信公众号，用户通过发送消息与系统交互
2. **后端服务**: 基于web.py的HTTP服务，接收并处理微信公众号的请求
3. **数据存储**: MySQL数据库，存储电影信息、用户信息、评分数据等
4. **推荐引擎**: 实现基于用户的协同过滤(User-CF)和基于内容的推荐算法

### 核心模块

- `main.py`: 主应用入口，处理微信服务器的HTTP请求
- `wechat_handler.py`: 处理微信消息的解析和回复
- `db_manager.py`: 数据库交互接口，封装SQL操作
- `recommendation_engine.py`: 推荐算法实现，包括协同过滤和基于内容的推荐
- `config.py`: 系统配置信息
- `utils.py`: 通用工具函数

### 数据库设计

系统包含四个核心数据表:

1. **movies**: 存储电影基本信息（标题、评分、演员、简介等）
2. **users**: 存储用户信息（微信OpenID等）
3. **ratings**: 存储用户对电影的评分记录
4. **search_logs**: 记录用户搜索历史(可选功能)

## 系统功能

### 1. 电影搜索

用户可以通过发送电影名称来搜索电影信息。系统支持:
- 精确匹配: 完全匹配电影名称
- 模糊匹配: 当精确匹配无结果时，会返回相关的电影列表

### 2. 电影评分

用户可以通过发送格式为"评价 电影名 评分"的消息为电影评分，如"评价 肖申克的救赎 9.5"。系统会:
- 验证评分格式和有效范围(0-10分)
- 自动调整超出范围的评分
- 记录或更新用户评分

### 3. 个性化推荐

用户发送"推荐"时，系统会基于以下策略生成个性化电影推荐:
- 对于有足够评分历史的用户，使用协同过滤算法
- 对于新用户或评分较少的用户，使用基于内容的推荐
- 推荐结果优先考虑用户未看过、评分较高的电影

### 4. 新用户欢迎

当用户首次关注公众号时，系统会:
- 发送欢迎消息和使用说明
- 在数据库中创建用户记录

## 安装与部署

### 前提条件

- Python 3.8+ (推荐3.9)
- MySQL 8.0+
- 已注册的微信公众号(订阅号或服务号)

### 安装步骤

1. **克隆代码库**
   ```bash
   git clone https://github.com/Boulea7/Movie_recommender_wechat.git
   cd Movie_recommender_wechat
   ```

2. **创建虚拟环境**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/macOS
   # .venv\Scripts\activate   # Windows
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **初始化数据库**
   - 创建MySQL数据库和用户
   ```sql
   CREATE DATABASE movie_recommendation_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   CREATE USER 'movie_rec_user'@'localhost' IDENTIFIED BY 'MovieRecDbP@ssw0rd';
   GRANT ALL PRIVILEGES ON movie_recommendation_system.* TO 'movie_rec_user'@'localhost';
   FLUSH PRIVILEGES;
   ```
   - 导入数据结构和测试数据
   ```bash
   mysql -u movie_rec_user -p movie_recommendation_system < database_schema.sql
   ```

5. **配置微信公众号**
   - 在微信公众平台->开发->基本配置中设置:
     - 服务器地址(URL): `http://您的服务器IP/`
     - 令牌(Token): `HelloMindsnap`
     - 消息加解密方式: 明文模式或兼容模式

### 部署服务

使用提供的部署脚本`deploy.sh`进行自动部署:
```bash
sudo bash deploy.sh
```

部署脚本会自动:
1. 检查环境并创建虚拟环境
2. 安装必要依赖
3. 初始化数据库(可选)
4. 启动web服务并监听80端口
5. 生成部署日志

### 管理服务

- **启动服务**: `sudo bash start.sh`
- **停止服务**: `sudo bash stop.sh`
- **查看日志**: `tail -f app.log`

## 使用指南

用户可以通过以下方式与微信公众号互动:

1. **搜索电影**: 直接发送电影名称
2. **评价电影**: 发送 "评价 电影名 评分"，如 "评价 肖申克的救赎 9.5"
3. **获取推荐**: 发送 "推荐"

## 项目进展

- [x] 完成基础架构设计
- [x] 实现微信消息处理接口
- [x] 完成电影搜索功能
- [x] 完成电影评分功能
- [x] 实现基于用户的协同过滤算法
- [x] 实现基于内容的推荐算法
- [x] 完成部署脚本
- [x] 更新项目署名信息和欢迎语
- [ ] 优化推荐算法精度
- [ ] 添加更多电影数据
- [ ] 增加管理员界面

## 最近更新 (2025-01-27)

### 署名信息更新
- 在所有核心代码文件中添加了作者署名：刘鑫凯 (毕业设计作品)
- 更新了项目标题为"基于协同过滤算法的电影推荐系统研究与实现"
- 在README.md中明确标注了项目性质和研究方向

### 欢迎语优化
- 重新设计了用户关注公众号时的欢迎语，更加生动有趣
- 突出显示"刘鑫凯的智能电影推荐世界"，个性化署名
- 使用丰富的emoji图标和视觉层次，提升用户体验
- 详细介绍了系统功能和使用方法，增加了具体示例
- 在欢迎语中加入了毕业设计作品的完整署名信息
- 欢迎语长度控制在合理范围内，符合微信消息限制

### 代码健壮性改进
- **输入验证增强**: 对所有用户输入进行严格验证，防止空值、过长内容和恶意输入
- **数据库连接优化**: 添加连接重试机制、超时配置和连接测试
- **错误处理完善**: 改进异常捕获和错误消息提示，提供更友好的用户反馈
- **速率限制机制**: 新增速率限制器，防止用户频繁请求，保护系统稳定性
- **消息处理加固**: 增强XML消息解析的安全性和容错性
- **推荐算法优化**: 改进协同过滤算法的数据验证和异常处理

## 技术难点与解决方案

1. **冷启动问题**: 对于没有足够评分历史的用户，通过基于内容的推荐算法提供高质量电影。
2. **数据稀疏性**: 通过设置最小共同评分电影数量(MIN_COMMON_RATINGS)，确保用户相似度计算的可靠性。
3. **推荐多样性**: 在基于内容的推荐中引入随机选择机制，增加推荐结果的多样性。
4. **微信消息处理**: 设计严格的消息格式解析和错误处理，提高系统稳定性。

## 未来计划

1. 实现更多推荐算法(如基于物品的协同过滤、矩阵分解)
2. 增加个性化推荐参数调整功能
3. 支持更丰富的用户交互方式
4. 添加电影数据自动更新机制 