# 电影推荐系统部署指南（小白版）

**适用人群:** 完全不熟悉互联网和服务器部署的初学者

## 一、准备工作

### 1.1 你需要什么

在开始部署电影推荐系统之前，你需要准备：

- 一台可以联网的电脑（Windows、Mac或Linux均可）
- 一台云服务器（推荐阿里云ECS，最低配置即可：1核2G内存）
- 一个域名（可选，但推荐有）
- 一个微信公众号（至少是订阅号）

### 1.2 购买服务器

如果你还没有服务器，可以按照以下步骤购买：

1. 打开浏览器，进入阿里云官网：https://www.aliyun.com/
2. 注册一个阿里云账号（需要手机号验证）
3. 登录后，点击"产品"->"云服务器ECS"
4. 点击"立即购买"，选择配置：
   - 地域：选择离你较近的区域
   - 实例规格：入门级（1核2G）
   - 镜像：Ubuntu 20.04（推荐）
   - 存储：默认的系统盘即可
   - 带宽：按需选择（1Mbps起步）
   - 安全组：开放80端口（HTTP）和22端口（SSH）
5. 完成支付后，记录下服务器的公网IP地址

### 1.3 注册微信公众号

1. 访问微信公众平台：https://mp.weixin.qq.com/
2. 点击"立即注册"，选择"订阅号"类型
3. 按照指引完成注册，需要提供个人或企业信息
4. 注册成功后登录公众平台，记录下你的公众号ID

## 二、连接到你的服务器

### 2.1 Windows用户

1. 下载并安装PuTTY软件：https://www.putty.org/
2. 打开PuTTY，在"Host Name"框中输入你的服务器IP地址
3. 端口保持默认的22
4. 点击"Open"按钮
5. 初次连接会弹出安全警告，点击"是"
6. 输入用户名：`root`（或云服务商提供的默认用户名）
7. 输入购买服务器时设置的密码

### 2.2 Mac/Linux用户

1. 打开终端应用
2. 输入命令：`ssh root@你的服务器IP`（替换为实际IP地址）
3. 初次连接会询问是否继续，输入`yes`
4. 输入服务器密码

### 2.3 验证连接

成功登录后，你会看到类似这样的提示：
```
Welcome to Ubuntu 20.04.4 LTS
```

## 三、安装必要软件

已连接到服务器后，复制以下命令，粘贴到命令行并回车执行：

### 3.1 更新系统

```bash
apt update && apt upgrade -y
```
（输入后按回车，等待完成）

### 3.2 安装Python和相关工具

```bash
apt install -y python3 python3-pip python3-venv git mysql-server
```
（输入后按回车，等待完成）

### 3.3 安装并配置MySQL

```bash
# 启动MySQL安全配置向导
mysql_secure_installation
```

按照提示操作：
- 是否设置密码验证插件？输入`y`
- 设置root密码强度：推荐选择中等（1）
- 设置一个强密码并记住它！
- 其余选项都输入`y`

## 四、下载电影推荐系统代码

### 4.1 克隆代码仓库

```bash
cd /home
git clone https://github.com/Boulea7/Movie_recommender_wechat.git
cd Movie_recommender_wechat
```

### 4.2 设置权限

```bash
chmod +x *.sh
```

## 五、配置数据库

### 5.1 创建数据库和用户

```bash
# 登录MySQL
mysql -u root -p
```
（输入你之前设置的MySQL root密码）

然后在MySQL命令行中执行：

```sql
CREATE DATABASE movie_recommendation_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'movie_rec_user'@'localhost' IDENTIFIED BY 'MovieRecDbP@ssw0rd';
GRANT ALL PRIVILEGES ON movie_recommendation_system.* TO 'movie_rec_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 5.2 导入电影数据

```bash
mysql -u movie_rec_user -p'MovieRecDbP@ssw0rd' movie_recommendation_system < database_schema.sql
```

## 六、配置微信公众号

### 6.1 进入开发者设置

1. 登录微信公众平台：https://mp.weixin.qq.com/
2. 点击左侧菜单"设置与开发"->"基本配置"
3. 在"服务器配置"部分，点击"修改配置"

### 6.2 填写服务器信息

- **服务器地址(URL):** `http://你的服务器IP/`（注意末尾必须有/）
- **令牌(Token):** `HelloMindsnap`（必须与程序中一致）
- **消息加解密方式:** 选择"明文模式"
- 点击"提交"（先不要点击！需要等系统部署后才能验证通过）

## 七、部署电影推荐系统

### 7.1 运行部署脚本

```bash
sudo bash deploy.sh
```

按照脚本提示进行操作：
- 当询问是否创建/初始化数据库时，可以输入`n`（因为我们已经手动创建了）
- 当询问是否需要修改数据库连接配置时，可以根据实际情况决定
  - 如果你按照指南创建的数据库用户名和密码，可以输入`n`
  - 如果你使用了不同的设置，输入`y`并按提示填写
- 其他问题按照提示操作

### 7.2 验证部署成功

部署脚本执行完毕后，应该会显示：
```
Mindsnap 电影推荐系统部署完成！
```

你可以使用以下命令检查服务是否正在运行：
```bash
ps aux | grep python
```

你应该能看到一个python进程在运行。

### 7.3 测试服务是否可访问

在你的电脑浏览器中访问：
```
http://你的服务器IP/
```

如果显示"Bad Request"或任何响应（而不是无法连接），说明服务已经在正常监听。

## 八、完成微信公众号配置

现在系统已经部署好，回到之前的微信公众平台页面：

1. 在"服务器配置"部分，确认填写：
   - **服务器地址(URL):** `http://你的服务器IP/`
   - **令牌(Token):** `HelloMindsnap`
   - **消息加解密方式:** 明文模式
2. 点击"提交"
3. 如果配置正确，会显示"配置成功"

## 九、使用和维护

### 9.1 关注你的公众号

用微信扫描你公众号的二维码，关注它。然后可以：
- 发送任意电影名称进行搜索
- 发送"评价 电影名 评分"给电影打分
- 发送"推荐"获取电影推荐

### 9.2 管理你的服务

- **启动服务:** `sudo bash /home/Movie_recommender_wechat/start.sh`
- **停止服务:** `sudo bash /home/Movie_recommender_wechat/stop.sh`
- **查看日志:** `tail -f /home/Movie_recommender_wechat/app.log`

### 9.3 服务器重启后

如果你的服务器重启了，你需要重新启动推荐系统：
```bash
cd /home/Movie_recommender_wechat
sudo bash start.sh
```

## 十、常见问题排查

### 10.1 微信公众号配置验证失败

1. 检查你的服务是否正在运行：`ps aux | grep python`
2. 确认80端口是否开放：`sudo lsof -i :80`
3. 检查服务器防火墙是否允许80端口流量：`sudo ufw status`
4. 检查URL格式是否正确（必须包含http://前缀和末尾的/）
5. 确认Token与配置文件中的`WECHAT_TOKEN`一致

### 10.2 发送消息没有回复

1. 查看日志文件：`tail -f /home/Movie_recommender_wechat/app.log`
2. 重启服务：`sudo bash /home/Movie_recommender_wechat/stop.sh && sudo bash /home/Movie_recommender_wechat/start.sh`
3. 检查数据库连接：`mysql -u movie_rec_user -p'MovieRecDbP@ssw0rd' -e "SELECT 1"`

### 10.3 推荐系统不工作

1. 确保你已经为至少5部电影评分
2. 检查日志中是否有错误信息
3. 验证数据库中是否有足够的电影数据

## 十一、升级和维护

定期执行以下命令保持服务器更新：

```bash
sudo apt update && sudo apt upgrade -y
```

定期备份数据库：

```bash
mysqldump -u movie_rec_user -p'MovieRecDbP@ssw0rd' movie_recommendation_system > backup-$(date +%Y%m%d).sql
```

## 特别提示

1. 在本文中提到的密码仅为示例，生产环境请使用更强的密码
2. 安全起见，不建议使用root用户运行服务，但对于初学者，我们简化了这一步骤
3. 本文假设你使用Ubuntu服务器，其他Linux发行版可能有所不同
4. 如果你打算长期运行服务，建议配置HTTPS和域名 