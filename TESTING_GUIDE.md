# 电影推荐系统测试指南

**项目团队:** Mindsnap团队的电影推荐系统分团队

**文档版本:** 1.0

**更新日期:** 2023-05-18

## 1. 测试环境

### 1.1 测试环境要求

* **客户端环境:** 
  * 微信客户端 (iOS/Android/Windows/MacOS 任意版本)
  * 网络连接稳定

* **服务端环境:**
  * 已部署的电影推荐系统服务
  * 80端口开放且可从外网访问
  * MySQL数据库正常运行
  * 数据库中已导入测试电影数据

* **微信公众号配置:**
  * 已完成基本配置:
    * 服务器地址(URL): `http://服务器IP/`
    * 令牌(Token): `HelloMindsnap`
    * 消息加解密方式: 明文模式或兼容模式
  * 已启用开发者模式

### 1.2 测试准备

1. 确保服务端运行状态正常: `sudo bash start.sh`
2. 检查日志确认无错误: `tail -f app.log`
3. 确认数据库连接正常且包含测试数据
4. 准备测试微信账号 (用于关注公众号进行测试)
5. 准备测试数据记录表，用于记录测试结果

## 2. 功能测试用例

### 2.1 功能测试用例表

| 序号 | 测试模块     | 测试场景                                     | 操作步骤                                                                | 预期结果                                                                                                                                                            | 实际结果 | 是否通过 |
| :--- | :---------- | :------------------------------------------ | :---------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------- | :------- |
| 1    | 用户关注     | 新用户首次关注公众号                         | 微信搜索并关注公众号                                                    | 1. 收到欢迎语和使用说明。<br>2. 后台`users`表新增该用户记录 (OpenID正确)。                                                                                            |          |          |
| 2    | 用户关注     | 之前已关注过的用户重新关注                   | 取消关注后，再次关注公众号                                              | 1. 收到欢迎语和使用说明。<br>2. 后台`users`表中该用户记录被更新 (last_active_at字段更新)。                                                                          |          |          |
| 3    | 电影搜索     | 精确搜索存在的电影                           | 发送电影名，如："肖申克的救赎"                                          | 收到该电影的详细信息 (标题、评分、简介等)。                                                                                                                           |          |          |
| 4    | 电影搜索     | 模糊搜索电影                                 | 发送部分电影名，如："阿甘"                                              | 收到包含"阿甘"的电影列表 (如"阿甘正传")，或单部最匹配电影信息。若无，提示未找到。                                                                                     |          |          |
| 5    | 电影搜索     | 搜索不存在的电影                             | 发送一个不存在的电影名，如："一部不存在的神奇电影"                      | 收到提示："未找到相关电影"。                                                                                                                                           |          |          |
| 6    | 电影评价     | 对存在的电影进行首次评分                     | 发送："评价 肖申克的救赎 9.5"                                           | 1. 收到"《肖申克的救赎》评分成功！"。<br>2. 后台`ratings`表新增该用户对该电影的评分记录。                                                                             |          |          |
| 7    | 电影评价     | 对已评分电影修改评分                         | 再次发送："评价 肖申克的救赎 9.0"                                       | 1. 收到"《肖申克的救赎》评分成功！"。<br>2. 后台`ratings`表中对应记录的评分更新为9.0。                                                                                |          |          |
| 8    | 电影评价     | 评价不存在的电影                             | 发送："评价 一部不存在的神奇电影 8.0"                                   | 收到错误提示，如："未找到电影《一部不存在的神奇电影》，无法评价。"                                                                                                      |          |          |
| 9    | 电影评价     | 评价格式错误 - 缺少评分                      | 发送："评价 肖申克的救赎"                                               | 收到格式错误提示，如："评价格式不正确，请使用'评价 电影名 评分'的格式。"                                                                                                 |          |          |
| 10   | 电影评价     | 评价格式错误 - 评分非数字                    | 发送："评价 肖申克的救赎 十分"                                          | 收到格式错误提示，如："评分必须是0-10之间的数字。"                                                                                                                       |          |          |
| 11   | 电影评价     | 评价分数超出范围 - 过高                      | 发送："评价 肖申克的救赎 11"                                            | 系统自动修正评分为10分，并返回："《肖申克的救赎》评分成功！评分已调整为有效范围(10分)。"                                                                                 |          |          |
| 12   | 电影评价     | 评价分数超出范围 - 过低                      | 发送："评价 肖申克的救赎 -1"                                            | 系统自动修正评分为0分，并返回："《肖申克的救赎》评分成功！评分已调整为有效范围(0分)。"                                                                                   |          |          |
| 13   | 个性化推荐   | 用户有足够评分数据                           | 1. 用户先对至少5部电影进行评分<br>2. 发送："推荐"                       | 收到基于协同过滤算法推荐的电影列表 (至少3部，不包含已评分电影)。                                                                                                        |          |          |
| 14   | 个性化推荐   | 冷启动用户 (新用户或评分数据少)               | 1. 新用户或仅对1-2部电影评分<br>2. 发送："推荐"                        | 收到基于内容推荐的电影列表 (可能包含豆瓣高分电影或流行电影)。                                                                                                           |          |          |
| 15   | 个性化推荐   | 推荐结果多样性 (多次请求)                    | 连续发送3次："推荐"                                                     | 若使用协同过滤，推荐结果应保持一致；若使用内容推荐，可能有一定变化。                                                                                                    |          |          |
| 16   | 异常输入     | 发送特殊字符                                 | 发送特殊字符，如："@#$%^&*"                                             | 系统应将其视为电影搜索，返回："未找到相关电影"。                                                                                                                        |          |          |
| 17   | 异常输入     | 发送超长文本                                 | 发送一段超过100字的文本                                                 | 系统应正常处理，可能将其视为电影搜索，返回："未找到相关电影"。                                                                                                           |          |          |
| 18   | 异常输入     | 发送空白消息                                 | 发送仅包含空格的消息                                                    | 系统应返回合理提示，如："请发送有效内容，如电影名称、'推荐'或'评价 电影名 评分'。"                                                                                        |          |          |
| 19   | 微信接口验证 | 公众号后台配置提交                           | 在微信公众号后台开发者配置页面，填写URL和Token后点击"提交"              | 提示"配置成功"。                                                                                                                                                        |          |          |
| 20   | 微信接口验证 | 修改Token后提交                              | 1. 修改服务器上Token值<br>2. 在微信公众号后台点击"提交"                 | 提示"Token验证失败"。                                                                                                                                                  |          |          |

### 2.2 测试注意事项

1. **数据依赖性:**
   - 测试用例13和14依赖于用户的评分数据量，应按顺序执行
   - 某些测试可能会相互影响，如电影评分后会影响推荐结果

2. **并发测试:**
   - 可尝试由多个用户同时发送消息，测试系统并发处理能力
   - 观察响应时间和系统稳定性

3. **网络延迟:**
   - 微信公众号消息可能存在网络延迟，建议等待5-10秒再判断测试结果

4. **数据验证:**
   - 对于涉及数据库操作的测试用例，应同时验证数据库中记录是否正确更新
   - 可通过MySQL客户端或命令行工具查询相关表的数据

## 3. 性能测试

### 3.1 响应时间测试

测试不同功能的响应时间，记录从发送消息到收到回复的时间：

1. 电影搜索响应时间
2. 电影评价响应时间 
3. 推荐功能响应时间（特别关注，协同过滤计算可能耗时较长）

### 3.2 并发用户测试

在条件允许的情况下，测试系统同时处理多个用户请求的能力：

1. 5个用户同时发送不同消息
2. 10个用户同时请求推荐功能
3. 观察系统资源占用情况（CPU、内存、数据库连接）

## 4. 安全性测试

1. **输入验证:**
   - 尝试发送包含SQL注入或XSS攻击的消息
   - 系统应当能正确过滤或拒绝处理恶意输入

2. **授权检查:**
   - 确保未关注公众号的用户无法使用系统功能

## 5. 测试结果记录表

| 测试日期 | 测试人员 | 测试环境 | 测试用例编号 | 测试结果 | 问题描述 | 修复状态 |
| :------- | :------- | :------- | :----------- | :------- | :------- | :------- |
|          |          |          |              |          |          |          |

## 6. 常见问题及解决方案

### 6.1 微信配置问题

1. **问题:** 微信公众号配置验证失败
   **解决方案:** 
   - 确认服务器URL正确（包括http://前缀和末尾的/）
   - 确认Token与代码中配置一致
   - 检查服务器防火墙是否开放80端口
   - 查看服务器日志检查错误信息

2. **问题:** 发送消息无响应
   **解决方案:**
   - 确认服务正在运行 `ps aux | grep python`
   - 检查日志文件 `tail -f app.log`
   - 重启服务 `sudo bash stop.sh && sudo bash start.sh`

### 6.2 推荐系统问题

1. **问题:** 推荐结果质量不佳
   **解决方案:**
   - 增加用户评分数据样本
   - 调整recommendation_engine.py中的相似度计算参数
   - 可考虑减小MIN_COMMON_RATINGS阈值，增大推荐范围

2. **问题:** 推荐响应时间过长
   **解决方案:**
   - 检查数据库索引是否建立
   - 优化SQL查询语句
   - 考虑增加缓存机制，减少重复计算

## 7. 持续改进建议

1. 实现更多推荐算法（如基于物品的协同过滤）
2. 引入A/B测试机制，评估不同推荐策略的效果
3. 增加用户反馈渠道，收集用户对推荐结果的评价
4. 建立推荐质量评估指标，定期评估系统性能 